<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Welcome</title>
  <link rel="stylesheet" href="./css/styles.css" />
<script src="../config.js"></script>
</head>
<body>
  <div class="chat-container text-center">
    <h1>Welcome to Calendar Chat</h1>
    <p>Log in with Google to access your calendar.</p>
    <a id="loginLink">
      <button id="authorizeButton">Login with Google</button>
    </a>
  </div>

  <script>
    (function () {
      const params = new URLSearchParams(window.location.search);
      const token = params.get("token");

      if (token) {
        // שמירת ה-JWT
        localStorage.setItem("AUTH_TOKEN", token);
        console.log("token - index.html");

        // ניקוי הכתובת
        const clean = window.location.origin + window.location.pathname;
      window.history.replaceState({}, document.title, clean);

        // מעבר לצ'אט
        window.location.href = "/app/chat.html";
        return;
      }

const base = (window.APP_CONFIG.API_BASE || '').replace(/\/+$/, '');
const API_BASE = base.endsWith('/api') ? base : base + '/api';

// בלי query string בכלל:
const next = encodeURIComponent(`${window.APP_CONFIG.FRONTEND_BASE}/index.html`);
const loginUrl = `${API_BASE}/auth/google/login?next=${next}`;
document.getElementById("loginLink").href = loginUrl;


    })();
  </script>
</body>
</html>
