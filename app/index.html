<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Welcome</title>
  <link rel="stylesheet" href="./css/styles.css" />
<script src="../config.js"></script>
</head>
<body>
  <div class="chat-container text-center">
    <h1>Welcome to Calendar Chat</h1>
    <p>Log in with Google to access your calendar.</p>
    <a id="loginLink">
      <button id="authorizeButton">Login with Google</button>
    </a>
  </div>

  <script>
    (function () {
      const params = new URLSearchParams(window.location.search);
      const token = params.get("token");

      if (token) {
        // שמירת ה-JWT
        localStorage.setItem("AUTH_TOKEN", token);

        // ניקוי הכתובת
        window.history.replaceState({}, "", window.location.pathname);

        // מעבר לצ'אט
        window.location.href = "/app/chat.html";
        return;
      }

      // אם אין token — מגדירים את קישור הלוגין
      const redirectUri = encodeURIComponent(`${window.APP_CONFIG.FRONTEND_BASE}/app/index.html`);
      const base = (window.APP_CONFIG.API_BASE || '').replace(/\/+$/,'');
      const API_BASE = base.endsWith('/api') ? base : base + '/api';
      const loginUrl = `${API_BASE}/oauth2/authorization/google?redirect_uri=${redirectUri}`;
      document.getElementById("loginLink").setAttribute("href", loginUrl);
    })();
  </script>
</body>
</html>
